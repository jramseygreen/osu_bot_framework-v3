<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <title>OBF3</title>
    <link rel="shortcut icon" type="image/png"
          href="https://media.discordapp.net/attachments/902919147929886830/909331674540691466/bitmap.png"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
<div id="app" class="container-fluid">
    <!--    sidebar-->
    <div class="row">
        <div class="col d-flex flex-column text-white bg-dark" style="height: 100vh;">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                <div class="row">
                    <div class="col-3">
                        <img src="https://media.discordapp.net/attachments/902919147929886830/909331674540691466/bitmap.png"
                             width="50" height="50">
                    </div>
                    <div class="col-9">
                        <h3 class="text-center">OBF-3</h3>
                    </div>
                </div>
            </a>
            <hr>
            <span class="fs-4 mb-2">Channels</span>
            <ul class="nav nav-pills flex-column mb-auto" id="channels">
                <li v-for="channel in channels" class="nav-item">
                    <span :id="channel" class="nav-link">
                        <a :name="channel" href="javascript:void(0);" aria-current="page" onclick="setChannel(this)"
                           style="text-decoration: none;">
                            <svg class="bi me-2" width="16" height="16"></svg>
                            <span class="text-light">{{channel}}
                        </span>
                        </a>
                        <button :name="channel" type="button" title="Leave Channel"
                                class="badge badge-sm bg-danger float-end"
                                onclick="part_channel(this)">X
                        </button>
                    </span>
                </li>
            </ul>
            <hr>
            <!-- Button trigger modal -->
            <button class="nav-link text-white text-center rounded-pill bg-secondary" data-bs-toggle="modal"
                    data-bs-target="#personalMessages">
                Personal Messages
            </button>

            <!-- personal messages -->
            <div class="modal fade" id="personalMessages" tabindex="-1" role="dialog"
                 aria-labelledby="#personalMessagesLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body text-dark">
                            <div class="card text-white bg-secondary text-center">
                                <h3 class="card-title">Personal Messages</h3>
                                <hr>
                                <div class="container">
                                    <div class="card text-white bg-dark">
                                        <div style="overflow-y: scroll; height: 50vh;">
                                            <table class="table text-white">
                                                <thead>
                                                <tr>
                                                    <th>From</th>
                                                    <th>To</th>
                                                    <th>Message</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="message in personal_messages">
                                                    <th scope="row">{{message.username}}</th>
                                                    <th>{{message.channel}}</th>
                                                    <td>{{message.content}}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!--                                    input section-->
                                    <div class="card mb-4">
                                        <form onsubmit="return false">
                                            <div class="input-group mt-1 mb-1">
                                                <input type="text" class="form-control"
                                                       placeholder="Username" style="max-width: 15%;" id="pm_username">
                                                <input type="text" class="form-control"
                                                       placeholder="Say something..." id="personal_message">
                                                <button class="btn btn-dark" type="submit"
                                                        onclick="send_message('personal_message', document.getElementById('pm_username').value)">
                                                    Send
                                                </button>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <!-- make room -->
            <button id="make_room_button" type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
                    data-bs-target="#makeRoom">
                Make Room
            </button>

            <!-- make room Modal -->
            <div class="modal fade" id="makeRoom" tabindex="-1" role="dialog"
                 aria-labelledby="#makeRoomLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-dark" id="makeRoomLabel">Make a new game room</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!--                        modal body-->
                        <div class="modal-body text-dark">
                            <form id="make_room_form">
                                <div class="mb-3">
                                    <h5 class="text-dark">Room Title</h5>
                                    <input type="text" class="form-control" id="make_room_title">
                                </div>
                                <div class="mb-3">
                                    <h5 class="text-dark">Password</h5>
                                    <input type="text" class="form-control" id="make_room_password">
                                </div>
                                <div class="container mb-4">
                                    <div class="row text-center justify-content-center">
                                        <div class="card col-3">
                                            <h5>Game Mode</h5>
                                            <div class="btn-group mb-3">
                                                <button type="button" class="btn btn-dark" disabled>
                                                    {{make_room.game_mode}}
                                                </button>
                                                <button type="button"
                                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                        data-bs-toggle="dropdown" aria-expanded="false">
                                                    <span class="visually-hidden">Toggle Dropdown</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('game_mode', 'any')">any</a></li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('game_mode', 'osu')">osu</a></li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('game_mode', 'taiko')">taiko</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('game_mode', 'mania')">mania</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('game_mode', 'catch')">catch</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="card col-3 mx-2">
                                            <h5>Team Type</h5>
                                            <div class="btn-group mb-3">
                                                <button type="button" class="btn btn-dark" disabled>
                                                    {{make_room.team_type}}
                                                </button>
                                                <button type="button"
                                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                        data-bs-toggle="dropdown" aria-expanded="false">
                                                    <span class="visually-hidden">Toggle Dropdown</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('team_type', 'any')">any</a></li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('team_type', 'head-to-head')">head-to-head</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('team_type', 'tag-coop')">tag-coop</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('team_type', 'team-vs')">team-vs</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('team_type', 'tag-team-vs')">tag-team-vs</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="card col-3">
                                            <h5>Scoring Type</h5>
                                            <div class="btn-group mb-3">
                                                <button type="button" class="btn btn-dark" disabled>
                                                    {{make_room.scoring_type}}
                                                </button>
                                                <button type="button"
                                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                        data-bs-toggle="dropdown" aria-expanded="false">
                                                    <span class="visually-hidden">Toggle Dropdown</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('scoring_type', 'any')">any</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('scoring_type', 'score')">score</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('scoring_type', 'scorev2')">scorev2</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('scoring_type', 'accuracy')">accuracy</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                           onclick="make_room_dropdown('scoring_type', 'combo')">combo</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                            onclick="make_room(this.form)">Create
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- join channel -->
            <button type="button" class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#joinChannel">
                Join Channel
            </button>

            <!-- join channel Modal -->
            <div class="modal fade" id="joinChannel" tabindex="-1" role="dialog"
                 aria-labelledby="#joinChannelLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-dark" id="joinChannelLabel">Join a channel</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!--                        modal body-->
                        <div class="modal-body text-dark">

                            <form id="join_channel_form">
                                <div class="mb-3">
                                    <h5 class="text-dark">Channel to join</h5>
                                    <input type="text" placeholder="e.g. #mp_1234567, #osu, #lobby" class="form-control"
                                           id="join_form_channel">
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                            onclick="join_channel(this.form)">
                                        Join
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--        main content-->
        <!--        start page-->
        <div v-if="channel === ''" class="col-10">
            <div class="card text-white bg-dark" style="height: 100vh;">
                <div class="text-center">
                    <h2 class="card-header">
                        Welcome to Osu Bot Framework v3!
                    </h2>
                    <hr>
                    <img src="https://media.discordapp.net/attachments/902919147929886830/909331674540691466/bitmap.png"
                         width="600" height="600" class="mt-4">
                </div>
            </div>
        </div>
        <!--        channel view-->
        <div v-else class="col-10">
            <div class="card text-white bg-dark" style="height: 100vh;">
                <div class="card-header text-center">
                    <template>
                        <div v-if="title.includes('mp_')">
                            <a :href="'https://osu.ppy.sh/mp/' + channel.replace('#mp_', '')" target="_blank"
                               class="text-light" style="text-decoration: none;">
                                <h2>{{title}}</h2>
                            </a>
                            <a :href="config_link" target="_blank" class="text-light">
                                <small>View configuration page</small>
                            </a>
                        </div>
                        <div v-else>
                            <h2>{{title}}</h2>
                        </div>
                    </template>
                </div>
                <span class="badge bg-success">{{inProgress}}</span>
                <hr>
                <!--                limits and ranges-->
                <div v-show="channel.includes('#mp_')" class="container card-body text-center">
                    <div class="row">
                        <div class="col-1 card bg-secondary">
                            AR range
                            min
                            <input type="range" class="form-range" min="0" max="10" step="1" id="arRangeMin">
                            max
                            <input type="range" class="form-range" min="0" max="10" step="1" id="arRangeMax">
                        </div>
                        <div class="col-1 card bg-secondary">
                            OD range
                        </div>
                        <div class="col-1 card bg-secondary">
                            CS range
                        </div>
                        <div class="col-1 card bg-secondary">
                            HP range
                        </div>
                        <div class="col-1 card bg-secondary">
                            BPM range
                        </div>
                        <div class="col-1 card bg-secondary">
                            Length range
                        </div>
                        <div class="col-1 card bg-secondary">
                            Difficulty range
                        </div>
                        <div class="col-1 card bg-secondary">
                            Game Mode
                        </div>
                        <div class="col-1 card bg-secondary">
                            Mods
                        </div>
                        <div class="col-1 card bg-secondary">
                            Scoring Type
                        </div>
                        <div class="col-1 card bg-secondary">
                            Team Type
                        </div>
                        <div class="col-1 card bg-secondary">
                            Map Status
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row">
                        <!--                    players-->
                        <div class="col-3">
                            <div class="card text-white bg-secondary">
                                <h3 class="text-center mt-2">Players<span
                                        class="card-header badge ms-4 bg-light text-dark">{{users.length}}</span>
                                </h3>
                                <hr>

                                <div style="overflow-y: scroll; height: 59vh">
                                    <table class="table table-sm text-white">
                                        <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Username</th>
                                            <th scope="col">Badges</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <template>
                                            <tr v-for="(slot, index) in slots">
                                                <th scope="row">{{parseInt(index) + 1}}</th>
                                                <td>{{slot.username}}</td>
                                                <!--badges-->
                                                <td>
                                                    <span v-show="slot.username === host && host !== '' && channel.includes('mp_')"
                                                          :slot="slot" title="Host"
                                                          class="badge bg-dark text-warning">‚ôî</span>
                                                    <span v-show="slot.team === 'red' && channel.includes('mp_')"
                                                          :slot="slot" title="Red Team"
                                                          class="badge bg-danger text-light">Red</span>
                                                    <span v-show="slot.team === 'blue' && channel.includes('mp_')"
                                                          :slot="slot" title="Blue Team"
                                                          class="badge bg-primary text-light">Blue</span>
                                                    <span v-show="referees.includes(slot.username.replace(' ', '')) && channel.includes('mp_')"
                                                          :slot="slot" title="Referee"
                                                          class="badge bg-dark text-success">üõ°Ô∏è</span>

                                                </td>
                                            </tr>
                                        </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!--                    chat-->
                        <div class="col-7">
                            <div class="card text-white bg-secondary text-center">
                                <h3 class="card-title">Chat</h3>
                                <hr>
                                <div class="container">
                                    <div class="card text-white bg-dark text-start">
                                        <div style="overflow-y: scroll; height: 50vh;">
                                            <table id="chat" class="table table-sm text-white">
                                                <tbody>
                                                <tr v-for="message in messages">
                                                    <td class="col-12"><span class="badge bg-secondary">{{message.username}}</span>
                                                        <p class="ms-1">{{message.content}}</p>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!--                                    input section-->
                                    <div class="card mb-4">
                                        <form onsubmit="return false">
                                            <div class="input-group mt-1 mb-1">
                                                <input id="channel_message" type="text" class="form-control"
                                                       placeholder="Say something...">
                                                <button class="btn btn-dark" type="submit"
                                                        onclick="send_message('channel_message', app.channel)">Send
                                                </button>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-2">
                            <!--                        beatmap-->
                            <div v-show="channel.includes('#mp_')" class="card bg-secondary mb-4">
                                <h3 class="card-header text-center">Beatmap</h3>
                                <a :href="beatmap.url" target="_blank" style="text-decoration: none;">
                                    <h5 class="text-center text-light mt-2">{{beatmapName}}</h5>
                                    <hr>
                                    <img :src="beatmapImage"
                                         class="rounded"
                                         alt="..."
                                         width="190" style="max-width: 100%;">
                                </a>
                                <hr>
                                <div class="mb-3">
                                    <div v-if="Object.keys(beatmap).length > 2">
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.difficulty_rating}} ‚òÖ</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmapLength}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.mode}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.status}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.bpm}} BPM</span>
                                        <span class="badge rounded-pill bg-info text-dark">AR {{beatmap.ar}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">OD {{beatmap.accuracy}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">CS {{beatmap.cs}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">HP {{beatmap.drain}}</span>
                                    </div>
                                    <div v-else>
                                        <span class="badge rounded-pill bg-info text-dark">Unsubmitted</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card bg-secondary">
                                <!--                            buttons-->
                                <div class="dropdown text-center">
                                    <h6>Logic Profile</h6>
                                    <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="badge bg-secondary">{{logic_profile}}</span>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="logicProfiles">
                                        <li v-for="profile in logic_profiles"><a class="dropdown-item"
                                                                                 href="javascript:void(0);"
                                                                                 :id="profile"
                                                                                 onclick="set_logic_profile(this)">{{profile}}</a>
                                        </li>
                                    </ul>
                                </div>
                                <div v-show="channel.includes('#mp_')">
                                    <hr>
                                    <button type="button" class="btn btn-dark col-11 ms-2"
                                            onclick="close_room()">Close Room
                                    </button>
                                    <table class="table">
                                        <tbody>
                                        <tr>
                                            <td>
                                                <button type="button" class="btn btn-success" onclick="start_match()">
                                                    Start
                                                    Match
                                                </button>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-danger" onclick="abort_match()">
                                                    Abort
                                                    Match
                                                </button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <button type="button"
                                            class="btn rounded-pill btn-warning text-secondary col-11 ms-2 mb-3">
                                        Advanced
                                        Options
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script>
    var sock = new WebSocket("ws://localhost:9876/");
    var buffer;
    var app;
    window.onload = function () {
        sock.onopen = function () {
            sock.send(JSON.stringify({"command": "update"}));
        };

        sock.onclose = function () {
            document.body.innerHTML = '<span class="badge bg-danger text-light">The connection to the back end was lost! Please <a href="">refresh</a> the page!</span>'
        };

        sock.onerror = function (error) {
            console.log('WebSocket Error ' + error);
        };

        sock.onmessage = function (e) {
            console.log('Server: ' + e.data);
            buffer = JSON.parse(e.data);
            if (e.data !== JSON.stringify(app.buffer)) {
                app.buffer = buffer;
                app.channels = Object.keys(buffer["channels"]);
                app.personal_messages = buffer["pm"];
                if (app.channel !== "" && app.channels.includes(app.channel)) {
                    app.title = app.channel;
                    app.logic_profiles = buffer["logic_profiles"];
                    app.logic_profile = buffer["channels"][app.channel]["logic_profile"];
                    app.slots = buffer["channels"][app.channel]["slots"];
                    app.messages = buffer["channels"][app.channel]["messages"];
                    app.users = buffer["channels"][app.channel]["users"];
                    if (app.channel.includes("#mp_")) {
                        app.title += " - " + buffer["channels"][app.channel]["title"];
                        app.config_link = buffer["channels"][app.channel]["config_link"];
                        app.host = buffer["channels"][app.channel]["host"];
                        app.referees = buffer["channels"][app.channel]["referees"];
                        app.inProgress = (buffer["channels"][app.channel]["in_progress"] ? "In Progress..." : "");
                        app.beatmap = buffer["channels"][app.channel]["beatmap"];
                        app.beatmapName = buffer["channels"][app.channel]["beatmap_name"];
                        app.beatmapImage = "https://assets.ppy.sh/beatmaps/" + buffer["channels"][app.channel]["beatmap"]["beatmapset_id"] + "/covers/cover.jpg";
                        if (Math.floor(app.beatmap["hit_length"] / 60) > 0) {
                            app.beatmapLength = Math.floor(app.beatmap["hit_length"] / 60) + "min " + app.beatmap["hit_length"] % 60 + "sec";
                        } else {
                            app.beatmapLength = app.beatmap["hit_length"] + "sec";
                        }
                    }

                } else {
                    app.channel = "";
                }
            }

        };
    };

    app = new Vue({
        el: "#app",
        data: {
            buffer: {},
            config_link: "",
            channel: "",
            logic_profiles: [],
            logic_profile: "",
            slots: {},
            users: [],
            referees: [],
            host: "",
            channels: [],
            inProgress: "",
            messages: [],
            beatmap: {},
            beatmapName: "",
            beatmapImage: "",
            beatmapLength: "",
            personal_messages: [],
            title: "",
            make_room: {
                "game_mode": "any",
                "scoring_type": "any",
                "team_type": "any"
            },
        }
    })

    function setChannel(data) {
        app.channel = data.getAttribute("name");
        var ul = document.getElementById("channels");
        var items = ul.getElementsByTagName("li");
        for (var i = 0; i < items.length; ++i) {
            items[i].firstElementChild.classList.remove("active");
        }
        document.getElementById(app.channel).classList.add("active");
        sock.send(JSON.stringify({"command": "update"}));
    }

    function set_logic_profile(profile) {
        payload = {
            "command": "set_logic_profile",
            "channel": app.channel,
            "profile": profile.getAttribute("id")
        };
        sock.send(JSON.stringify(payload));
        sock.send(JSON.stringify({"command": "update"}));
    }

    function start_match() {
        payload = {
            "command": "start_match",
            "channel": app.channel
        };
        sock.send(JSON.stringify(payload));
    }

    function abort_match() {
        payload = {
            "command": "abort_match",
            "channel": app.channel
        };
        sock.send(JSON.stringify(payload));
    }

    function make_room(form) {
        payload = {
            "command": "make_room",
            "title": form.elements.make_room_title.value,
            "password": form.elements.make_room_password.value,
            "game_mode": app.make_room["game_mode"],
            "team_type": app.make_room["team_type"],
            "scoring_type": app.make_room["scoring_type"],
        };
        form.reset();
        app.make_room["game_mode"] = "any";
        app.make_room["team_type"] = "any";
        app.make_room["scoring_type"] = "any";
        if (/^[\u0000-\u007f]*$/.test(payload["title"])) {
            sock.send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
    }

    function make_room_dropdown(dropdown, option) {
        app["make_room"][dropdown] = option
    }

    function join_channel(form) {
        payload = {
            "command": "join",
            "channel": form.elements.join_form_channel.value,
        };
        if (!(!payload["channel"].includes("mp_") && !confirm("Whilst joining public channels such as '" + payload["channel"] + "' is possible and supported, be aware that the sheer volume of players may cause this page to lag considerably.\n\nDo you still wish to join '" + payload["channel"] + "'?"))) {
            sock.send(JSON.stringify(payload));
        }
        form.reset();
    }

    function part_channel(data) {
        payload = {
            "command": "part",
            "channel": data.getAttribute("name"),
        };
        sock.send(JSON.stringify(payload));
        sock.send(JSON.stringify({"command": "update"}));
    }

    function send_message(inputObj, channel) {
        message = document.getElementById(inputObj).value;
        document.getElementById(inputObj).value = "";
        payload = {
            "command": inputObj,
            "channel": channel,
            "message": message
        };
        if (/^[\u0000-\u007f]*$/.test(payload["message"])) {
            sock.send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
    }

    function close_room() {
        payload = {
            "command": "close_room",
            "channel": app.channel
        };
        sock.send(JSON.stringify(payload));
    }
</script>

</body>
</html>
